import{J as P,d as ee,r as v,C as ie,c as s,o as p,e as y,f as e,w as a,g as J,Q as X,F as U,l as x,j as F,h as C,m as D,R as pe,K,x as ce,t as me,L as _e,v as ve,y as Y,z as Z,_ as fe}from"./index-83aa274e.js";const ge=(f,A,d)=>P.get(`/admin/product/${f}/${A}?category3Id=${d}`),be=f=>f.id?P.post("/admin/product/updateSpuInfo",f):P.post("/admin/product/saveSpuInfo",f),Se=()=>P.get("/admin/product/baseTrademark/getTrademarkList"),ye=f=>P.get("/admin/product/spuImageList/"+f),Ae=f=>P.get("/admin/product/spuSaleAttrList/"+f),he=()=>P.get("/admin/product/baseSaleAttrList"),Ve=["src"],Ie={style:{display:"flex","flex-wrap":"wrap"}},ke=ee({__name:"spuForm",emits:["changeScene"],setup(f,{expose:A,emit:d}){const I=v([]),L=v([]),o=v({id:void 0,spuName:"",description:"",category3Id:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),r=ie(()=>o.value.spuSaleAttrList.length==0?L.value:L.value.filter(t=>o.value.spuSaleAttrList.every(k=>t.id!=k.baseSaleAttrId))),_=v("");A({editSpu:l=>{Object.assign(o.value,{id:void 0,spuName:"",description:"",category3Id:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),S.value=[],_.value="",o.value=l,b(),z(),w(),N()},initAddSpu:l=>{console.log("新增"),Object.assign(o.value,{id:void 0,spuName:"",description:"",category3Id:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),S.value=[],_.value="",o.value.category3Id=l,b(),z()}});const b=()=>{console.log("请求spu品牌"),Se().then(l=>{console.log(l),I.value=l.data})},z=()=>{console.log("请求sp所有销售属性"),he().then(l=>{console.log(l),L.value=l.data})},w=()=>{console.log("请请求照片墙"),ye(o.value.id).then(l=>{l.data.forEach(t=>{S.value.push({name:t.imgName,url:t.imgUrl})})})},N=()=>{console.log("请求spu销售属性"),Ae(o.value.id).then(l=>{console.log(l),o.value.spuSaleAttrList=l.data})},R=()=>{console.log("添加销售属性");const[l,t]=_.value.split(":"),k={spuId:o.value.id,baseSaleAttrId:l,saleAttrName:t,spuSaleAttrValueList:[]};o.value.spuSaleAttrList.push(k),_.value=""},j=(l,t)=>{console.log("添加销售属性"),o.value.spuSaleAttrList.splice(t,1)},n=()=>{console.log("保存"),o.value.spuImageList=S.value.map(l=>({imgName:l.name,imgUrl:l.response&&l.response.data||l.url})),be(o.value).then(l=>{console.log(l),l.code==200?(K({type:"success",message:o.value.id?"更新成功":"添加成功"}),d("changeScene",{flag:0,params:o.value.id?"update":"add"})):K({type:"error",message:o.value.id?"更新失败":"添加失败"})})},M=()=>{console.log("取消"),d("changeScene",{flag:0,params:""})},c=(l,t)=>{o.value.spuSaleAttrList[l].spuSaleAttrValueList.splice(o.value.spuSaleAttrList[l].spuSaleAttrValueList.indexOf(t),1)},m=l=>{l.inputVisible=!0,l.inputValue="",ce(()=>{l.InputRef.focus()})},E=(l,t)=>{if(t.inputValue=="")K({type:"error",message:"属性值不能为空的"});else if(t.inputValue.length>0)if(o.value.spuSaleAttrList[l].spuSaleAttrValueList.findIndex($=>$.saleAttrValueName==t.inputValue)!=-1)K({type:"error",message:"属性值已存在"});else{const $={spuId:t.spuId,baseSaleAttrId:t.baseSaleAttrId,saleAttrName:t.saleAttrName,saleAttrValueName:t.inputValue,isChecked:!0};o.value.spuSaleAttrList[l].spuSaleAttrValueList.push($)}t.inputVisible=!1,t.inputValue=""},S=v([]),h=v(""),B=v(!1),O=(l,t)=>{console.log(l,t)},Q=l=>{h.value=l.url,B.value=!0},H=(l,t)=>{},W=l=>l.type!=="image/jpeg"?(K.error("Avatar picture must be JPG format!"),!1):l.size/1024/1024>2?(K.error("Avatar picture size can not exceed 2MB!"),!1):!0;return(l,t)=>{const k=s("el-form-item"),$=s("el-option"),le=s("el-select"),ae=s("Plus"),te=s("el-icon"),ne=s("el-upload"),oe=s("el-dialog"),T=s("el-button"),G=s("el-table-column"),ue=s("el-tag"),se=s("el-table"),de=s("el-form"),re=s("el-card");return p(),y("div",null,[e(re,{shadow:"always"},{default:a(()=>[e(de,{ref:"formRefAdd",class:"formAdd",model:o.value},{default:a(()=>[e(k,{label:"SPU名称"},{default:a(()=>[e(J(X),{modelValue:o.value.spuName,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.spuName=u),placeholder:"请您输入SPU名称",clearable:"",size:"small"},null,8,["modelValue"])]),_:1}),e(k,{label:"SPU品牌"},{default:a(()=>[e(le,{modelValue:o.value.tmId,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.tmId=u),placeholder:"请选择你的品牌",size:"small"},{default:a(()=>[(p(!0),y(U,null,x(I.value,u=>(p(),D($,{key:u.id,label:u.tmName,value:u.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"SPU描述"},{default:a(()=>[e(J(X),{modelValue:o.value.description,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.description=u),rows:2,type:"textarea",placeholder:"请你输入描述"},null,8,["modelValue"])]),_:1}),e(k,{label:"SPU照片"},{default:a(()=>[e(ne,{"file-list":S.value,"onUpdate:fileList":t[3]||(t[3]=u=>S.value=u),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":Q,"on-remove":O,"on-success":H,"before-upload":W},{default:a(()=>[e(te,null,{default:a(()=>[e(ae)]),_:1})]),_:1},8,["file-list"]),e(oe,{modelValue:B.value,"onUpdate:modelValue":t[4]||(t[4]=u=>B.value=u)},{default:a(()=>[F("img",{"w-full":"",src:h.value,alt:"Preview Image"},null,8,Ve)]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"SPU销售属性"},{default:a(()=>[F("div",null,[e(le,{placeholder:r.value.length==0?"暂无可选销售属性":`还未选择${r.value.length}个`,size:"small",disabled:r.value.length==0,modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=u=>_.value=u)},{default:a(()=>[(p(!0),y(U,null,x(r.value,u=>(p(),D($,{key:u.id,label:u.name,value:`${u.id}:${u.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","disabled","modelValue"]),e(T,{style:{"margin-left":"10px"},type:"primary",size:"small",onClick:R,icon:"Plus",disabled:_.value.length==0},{default:a(()=>[C(" 添加销售属性 ")]),_:1},8,["disabled"])]),e(se,{data:o.value.spuSaleAttrList,border:"",style:{width:"100%",margin:"10px 0"}},{default:a(()=>[e(G,{type:"index",label:"序号",width:"80px",align:"center"}),e(G,{prop:"saleAttrName",label:"属性名",width:"120px"}),e(G,{"show-overflow-tooltip":!0,label:"属性值"},{default:a(({row:u,$index:q})=>[F("div",Ie,[(p(!0),y(U,null,x(u.spuSaleAttrValueList,V=>(p(),D(ue,{style:{margin:"5px 5px"},key:V,closable:"","disable-transitions":!1,onClose:Ue=>c(q,V)},{default:a(()=>[C(me(V.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),u.inputVisible?(p(),D(J(X),{key:0,ref:V=>u.InputRef=V,modelValue:u.inputValue,"onUpdate:modelValue":V=>u.inputValue=V,style:{margin:"5px 5px",width:"80px",height:"25px"},size:"small",onKeyup:pe(V=>E(q,u),["enter"]),onBlur:V=>E(q,u)},null,8,["modelValue","onUpdate:modelValue","onKeyup","onBlur"])):(p(),D(T,{key:1,class:"button-new-tag ml-1",style:{margin:"5px 5px",width:"80px",height:"25px"},size:"small",onClick:V=>m(u)},{default:a(()=>[C(" + New Tag ")]),_:2},1032,["onClick"]))])]),_:1}),e(G,{label:"操作",width:"120px"},{default:a(({row:u,$index:q})=>[e(T,{size:"small",type:"danger",icon:"Delete",title:"删除SPU销售属性",onClick:V=>j(u,q)},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),F("div",null,[e(T,{type:"primary",size:"small",onClick:n},{default:a(()=>[C(" 保存 ")]),_:1}),e(T,{type:"default",size:"small",onClick:M},{default:a(()=>[C(" 取消 ")]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Ce=ee({__name:"skuForm",emits:["changeScene"],setup(f,{emit:A}){const d=v({id:void 0,spuName:"",description:"",category3Id:"",tmId:"",spuSaleAttrList:[],spuImageList:[]}),I=()=>{console.log("保存")},L=()=>{console.log("取消"),A("changeScene",{flag:0,params:""})};return(o,r)=>{const _=s("el-input"),i=s("el-form-item"),g=s("el-option"),b=s("el-select"),z=s("el-form"),w=s("el-table-column"),N=s("el-button"),R=s("el-table"),j=s("el-card");return p(),y("div",null,[e(j,{shadow:"always"},{default:a(()=>[e(z,{ref:"formRefAdd",class:"formAdd",model:d.value},{default:a(()=>[e(i,{label:"SKU名称"},{default:a(()=>[e(_,{modelValue:d.value.spuName,"onUpdate:modelValue":r[0]||(r[0]=n=>d.value.spuName=n),placeholder:"SKU名称",clearable:"",size:"small"},null,8,["modelValue"])]),_:1}),e(i,{label:"价格(元)"},{default:a(()=>[e(_,{modelValue:d.value.spuName,"onUpdate:modelValue":r[1]||(r[1]=n=>d.value.spuName=n),placeholder:"价格(元)",clearable:"",size:"small",type:"number"},null,8,["modelValue"])]),_:1}),e(i,{label:"重量(克)"},{default:a(()=>[e(_,{modelValue:d.value.spuName,"onUpdate:modelValue":r[2]||(r[2]=n=>d.value.spuName=n),placeholder:"重量(克)",clearable:"",size:"small"},null,8,["modelValue"])]),_:1}),e(i,{label:"SKU描述"},{default:a(()=>[e(_,{modelValue:d.value.description,"onUpdate:modelValue":r[3]||(r[3]=n=>d.value.description=n),rows:2,type:"textarea",placeholder:"SKU描述"},null,8,["modelValue"])]),_:1}),e(i,{label:"平台属性"},{default:a(()=>[e(z,{inline:!0},{default:a(()=>[e(i,{label:"内存"},{default:a(()=>[e(b,null,{default:a(()=>[(p(),y(U,null,x([1,3,4],n=>e(g,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1})]),_:1}),e(i,{label:"内存"},{default:a(()=>[e(b,null,{default:a(()=>[(p(),y(U,null,x([1,3,4],n=>e(g,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1})]),_:1}),e(i,{label:"内存"},{default:a(()=>[e(b,null,{default:a(()=>[(p(),y(U,null,x([1,3,4],n=>e(g,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{label:"销售属性"},{default:a(()=>[e(z,{inline:!0},{default:a(()=>[e(i,{label:"内存"},{default:a(()=>[e(b,null,{default:a(()=>[(p(),y(U,null,x([1,3,4],n=>e(g,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1})]),_:1}),e(i,{label:"内存"},{default:a(()=>[e(b,null,{default:a(()=>[(p(),y(U,null,x([1,3,4],n=>e(g,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1})]),_:1}),e(i,{label:"内存"},{default:a(()=>[e(b,null,{default:a(()=>[(p(),y(U,null,x([1,3,4],n=>e(g,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{label:"图片名称"},{default:a(()=>[e(R,{ref:"tableRef",data:[1],border:"",style:{width:"100%"},onSelectionChange:r[4]||(r[4]=()=>{})},{default:a(()=>[e(w,{type:"selection",width:"55"}),e(w,{label:"图片"},{default:a(()=>[C("图片")]),_:1}),e(w,{prop:"spuName",label:"名称"}),e(w,{label:"操作"},{default:a(n=>[e(N,{size:"small",type:"warning"},{default:a(()=>[C("设置默认")]),_:1})]),_:1})]),_:1},512),F("div",null,[e(N,{type:"primary",size:"small",onClick:I},{default:a(()=>[C(" 保存 ")]),_:1}),e(N,{type:"default",size:"small",onClick:L},{default:a(()=>[C(" 取消 ")]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})])}}}),Le=ee({__name:"index",setup(f){const A=_e(),d=v(0),I=v(1),L=v(10),o=v(0),r=v([]),_=v(!1),i=v();ve(()=>A.c3Id,()=>{A.c3Id?g():r.value=[]});const g=(c=1)=>{I.value=c,ge(I.value,L.value,A.c3Id).then(m=>{console.log(m),m.code==200&&(r.value=m.data.records,o.value=m.data.total)})},b=({flag:c,params:m})=>{console.log(m),d.value=c,g(m=="add"?1:I.value)},z=()=>{d.value=1,i.value.initAddSpu(A.c3Id)},w=c=>{d.value=2},N=c=>{d.value=1,i.value.editSpu(c)},R=c=>{},j=c=>{},n=c=>{console.log(`${c} items per page`),g()},M=c=>{console.log(`current page: ${c}`),g(c)};return(c,m)=>{const E=s("Category"),S=s("el-button"),h=s("el-table-column"),B=s("el-popconfirm"),O=s("el-table"),Q=s("el-pagination"),H=s("el-card"),W=s("el-dialog");return p(),y("div",null,[e(E,{disabled:d.value!=0},null,8,["disabled"]),Y(e(H,{class:"bottom_card",shadow:"always"},{default:a(()=>[e(S,{type:"primary",size:"small",onClick:z,icon:"Plus",disabled:!J(A).c3Id},{default:a(()=>[C(" 添加SPU ")]),_:1},8,["disabled"]),e(O,{data:r.value,border:"",style:{width:"100%"}},{default:a(()=>[e(h,{type:"index",label:"序号",width:"80px",align:"center"}),e(h,{prop:"spuName",label:"SPU名称"}),e(h,{prop:"description","show-overflow-tooltip":!0,label:"SPU描述"}),e(h,{label:"操作"},{default:a(l=>[e(S,{type:"primary",size:"small",onClick:t=>w(l.row),icon:"Plus",title:"添加SPU"},null,8,["onClick"]),e(S,{type:"warning",size:"small",onClick:t=>N(l.row),icon:"Edit",title:"修改SPU"},null,8,["onClick"]),e(S,{type:"info",size:"small",onClick:t=>R(l.row),icon:"InfoFilled",title:"查看SKU列表"},null,8,["onClick"]),e(B,{title:"确定要删除该品牌吗?",onConfirm:t=>j(l.row)},{reference:a(()=>[e(S,{size:"small",type:"danger",icon:"Delete",title:"删除SPU"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(Q,{"current-page":I.value,"onUpdate:currentPage":m[0]||(m[0]=l=>I.value=l),"page-size":L.value,"onUpdate:pageSize":m[1]||(m[1]=l=>L.value=l),"page-sizes":[10,20,30,40,50],small:!0,background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:o.value,onSizeChange:n,onCurrentChange:M},null,8,["current-page","page-size","total"])]),_:1},512),[[Z,d.value==0]]),Y(e(ke,{ref_key:"spuFormRef",ref:i,class:"bottom_card",onChangeScene:b},null,512),[[Z,d.value==1]]),Y(e(Ce,{class:"bottom_card",onChangeScene:b},null,512),[[Z,d.value==2]]),e(W,{modelValue:_.value,"onUpdate:modelValue":m[2]||(m[2]=l=>_.value=l),title:"SKU列表"},{default:a(()=>[e(O,{data:[1,2,3],border:""},{default:a(()=>[e(h,{property:"date",label:"sku名字"}),e(h,{property:"name",label:"sku价格"}),e(h,{property:"address",label:"sku重量"}),e(h,{property:"address",label:"sku图片"})]),_:1})]),_:1},8,["modelValue"])])}}});const ze=fe(Le,[["__scopeId","data-v-f4bb4432"]]);export{ze as default};
